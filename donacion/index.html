<!doctype html>
<html lang="es">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="Description" content="Corre y cambia el mundo con SoliRun, la plataforma solidaria">
    <title>SoliRun</title>
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
    <link rel="preload" href="/resources/css/bootstrap.min.css" as="style">
    <link rel="preload" href="/resources/css/style.css" as="style">
    <noscript>
        <link rel="stylesheet" type="text/css" href="/resources/css/bootstrap.min.css" />
        <link rel="stylesheet" type="text/css" href="/resources/css/style.css" />
    </noscript>
</head>

<body>
    <style>
            #loader {
                background: url(/resources/img/logo.png) no-repeat 50% white;
                width: 100%;
                height: 100%;
                position: fixed;
                z-index: 100000;
            }
            @media screen and (max-width: 600px){
                #loader {
                    background-size: 70%;
                }
            }
        </style>
    <div id="loader"></div>
    
    <div class="navbar navbar-expand-md navbar fixed-top">
        <nav class="container">
            <a id="logo" class="navbar-brand" href='/'>
                <img class="img img-fluid" src="/resources/img/logoco.png" alt="Logotipo SoliRun">
                <span>SoliRun</span>
            </a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar" aria-controls="navbar" aria-expanded="false"
                aria-label="Toggle navigation">
                <span class="navbar-toggler-icon">
                    ≡
                </span>
            </button>

            <div class="collapse navbar-collapse" id="navbar">
                <ul class="navbar-nav mr-auto">
                    <li class="nav-item">
                        <a href="/proyectos" class="nav-link">Proyectos</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href='#colabora'>Colabora</a>
                    </li>
                </ul>
            </div>
        </nav>
    </div>

    <main id="inicio" role="main">

        <div id="proyectos">
            <div class="jumbotron donacion">
                <div class="container">
                    <h1 class="display-4 text-center">Pon tu granito de arena</h1>
                    <p class="text-center">Poco a poco entre todos podemos lograrlo todo</p>
                </div>
            </div>
            <div class="card mx-auto">
            <div class="container text-center" id="boxpersona">
                <span class="mt-3 perfil lima"></span>
                <h2>Hola </h2>
                <p></p>
                    <form id="form-donacion" class="card-body">
                        <input type="submit" onclick="enviadonacion(event)" class="btn btn-success btn-lg stravalink" role="button" value="Auto-repartir KMs">
                    </form>
                </div>
            </div>
        </div>

        <div id="colabora">
            <div class="jumbotron colabora">
                <div class="container">
                    <h1 class="display-4 text-center">Sin tí no podemos conseguirlo</h1>
                    <p class="text-center">Sólo con la colaboración de todos podemos llegar a conseguir todo lo que nos proponemos.</p>
                    <p class="text-center">
                        <a class="btn btn-primary btn-lg" href="#" role="button">Contacta con nosotros</a>
                    </p>
                </div>
            </div>
            <div class="container">
                <div class="row">
                    <div class="col-md-4">
                        <h2>Para causas solidarias</h2>
                        <p>Donec id elit non mi porta gravida at eget metus. Fusce dapibus, tellus ac cursus commodo, tortor
                            mauris condimentum nibh, ut fermentum massa justo sit amet risus. Etiam porta sem malesuada magna
                            mollis euismod. Donec sed odio dui. </p>
                        <p>
                            <a class="btn btn-secondary" href="#" role="button">Participa</a>
                        </p>
                    </div>
                    <div class="col-md-4">
                        <h2>Gracias a las empresas</h2>
                        <p>Donec id elit non mi porta gravida at eget metus. Fusce dapibus, tellus ac cursus commodo, tortor
                            mauris condimentum nibh, ut fermentum massa justo sit amet risus. Etiam porta sem malesuada magna
                            mollis euismod. Donec sed odio dui. </p>
                        <p>
                            <a class="btn btn-secondary" href="#" role="button">Contacta con nosotros</a>
                        </p>
                    </div>
                    <div class="col-md-4">
                        <h2>Por los alumnos</h2>
                        <p>Donec id elit non mi porta gravida at eget metus. Fusce dapibus, tellus ac cursus commodo, tortor
                            mauris condimentum nibh, ut fermentum massa justo sit amet risus. Etiam porta sem malesuada magna
                            mollis euismod. Donec sed odio dui. </p>
                        <p>
                            <a class="btn btn-success stravalink" href="/donacion" role="button">Conecta con Strava</a>
                        </p>
                    </div>
                </div>
            </div>
        </div>

    </main>

    <footer class="text-center">
        <p>&copy; SoliRun 2018</p>
    </footer>
    <script src="/resources/js/jquery-3.3.1.min.js"></script>
    <script src="/resources/js/popper.min.js"></script>
    <script src="/resources/js/bootstrap.min.js"></script>
    <script src="/resources/js/script.js"></script>
    <script>
        var parametros = decodeURIComponent(location.search).split('&');
        var access_token = parametros[0].split('=')[1];
        var id_alumno = parametros[2].split('=')[1];
        var nombre_alumno = parametros[4].split('=')[1];
        var perfil_alumno = parametros[15].split('=')[1];
        var distanciaTotal = 0;

        function enviadonacion(e){
            e.preventDefault();
            $.post('http://127.0.0.1/fct/api/public/api/donacion', $('#form-donacion').serialize())
            .done(function(r){
                if (r == 1) {
                    $('#boxpersona').append('<div class="alert alert-danger alert-dismissible">'+
                    ' <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>'+
                    ' <strong>No estás en la lista :(</strong> Comprueba con tu responsable si estás en la lista con tu ID de Strava.'+
                    '</div>');
                } else if(r == 2){
                    $('#boxpersona').append('<div class="alert alert-danger alert-dismissible">'+
                    ' <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>'+
                    ' <strong>Tienes que esperar un poco :(</strong> Sólo puedes hacer tus donaciones cada 24 horas, esta carrera sólo se gana día a día.'+
                    '</div>');
                } else {
                    $('#boxpersona').append('<div class="alert alert-success alert-dismissible">'+
                    ' <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>'+
                    ' <strong>Muchas gracias por tus KMs :)</strong> cada día estamos un poco más cerca de cumplir nuestros retos.'+
                    '</div>');
                }
            });
        }

        $(function(){
            $('#boxpersona h2').html('¡Hola '+nombre_alumno+'!');
            $('#boxpersona .perfil').css('background','url('+perfil_alumno+')');
            $.get(linkAct+access_token)
            .done(function(respuesta){
                console.log(respuesta);
                respuesta.forEach(function(e){
                    distanciaTotal += e.distance/1000;
                });
                $('#boxpersona > p').html('En las últimas 24 horas has recorrido '+distanciaTotal+' kms');
                $('#form-donacion').append('<input name="donacion" type="hidden" value="'+distanciaTotal+'">');
                $('#form-donacion').append('<input name="idalumno" type="hidden" value="'+id_alumno+'">');
            });
        });
    </script>
</body>
</html>